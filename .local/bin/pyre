#!/bin/bash
# =================================================================
#         PYRE ENGINE (v11.1 - "Ğ¡Ğ¸Ğ½Ñ‚ĞµĞ·" - Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ)
# =================================================================
# Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ, ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¾Ğ¹ Pywal.

# --- ĞŸĞ£Ğ¢Ğ˜ Ğ˜ ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ ---
WALLPAPER_DIR="$HOME/Pictures/Wallpapers"
STATE_FILE="$HOME/.config/pyre/state"
SCRIPTS_DIR="$HOME/.config/hypr/scripts"
ENGINE_THEMES_DIR="$HOME/.config/hypr/engine/themes"
WAL_CACHE_DIR="$HOME/.cache/wal"

# --- Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ ---

# --- Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ "ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ° Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ¾Ğ¹ ĞĞ±Ğ·Ğ¾Ñ€" ---
launch_file_layout() {
    hyprctl keyword source ~/.config/hypr/filemanager.conf
    sleep 0.2
    hyprctl dispatch exec thunar
    sleep 0.2
    hyprctl dispatch exec kitty --title "fm-yazi" yazi
}

# --- Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ "ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ° Ğ“Ğ¾Ğ»Ğ»Ğ¸Ğ²ÑƒĞ´" (v2.0 - Ñ Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ĞºĞ¾Ğ¹) ---
launch_hollywood_layout() {
    # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ½Ğ°ÑˆĞ¸ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ĞºĞ¸
    hyprctl keyword source ~/.config/hypr/hollywood.conf

    # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ñ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°Ğ¼Ğ¸
    sleep 0.2
    kitty --title "hollywood-clock" tty-clock -c -C 2 &
    sleep 0.2
    kitty --title "hollywood-cava" cava &
    sleep 0.2
    kitty --title "hollywood-matrix" unimatrix &
    sleep 0.2
    kitty --title "hollywood-pipes" pipes.sh &
}

# Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ñ‚ĞµĞ¼Ñ‹
apply_theme() {
    local theme_name_lower=$1
    local theme_name_capitalized=$(echo "$theme_name_lower" | awk '{print toupper(substr($0,1,1))substr($0,2)}')
    
    # --- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ: ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ Ğ² ĞºÑÑˆ Pywal ---
    cp "$ENGINE_THEMES_DIR/hypr/$theme_name_lower.conf" "$WAL_CACHE_DIR/colors-hyprland.conf"
    cp "$ENGINE_THEMES_DIR/waybar/$theme_name_lower.css" "$WAL_CACHE_DIR/colors-waybar.css"
    cp "$ENGINE_THEMES_DIR/kitty/$theme_name_lower.conf" "$WAL_CACHE_DIR/colors-kitty.conf"
    cp "$ENGINE_THEMES_DIR/dunst/$theme_name_lower.dunstrc" "$WAL_CACHE_DIR/colors-dunst"
    
    # --- ĞŸĞ•Ğ Ğ•Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡ĞĞ’ ---
    hyprctl reload
    pkill -SIGUSR2 waybar # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ±Ğ¾Ğ»ĞµĞµ Ğ¼ÑĞ³ĞºĞ¸Ğ¹ ÑĞ¸Ğ³Ğ½Ğ°Ğ» Ğ´Ğ»Ñ Waybar
    pkill dunst && dunst &
    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¸Ğ³Ğ½Ğ°Ğ» Ğ²ÑĞµĞ¼ Ğ¾ĞºĞ½Ğ°Ğ¼ Kitty Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ‚ĞµĞ¼Ñ‹
    kitty @ set-colors --all --configured "$WAL_CACHE_DIR/colors-kitty.conf"
    
    # Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¾Ğ±Ğ¾ĞµĞ², ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ñ‚ĞµĞ¼Ğµ
    THEME_WALLPAPER_DIR="$WALLPAPER_DIR/$theme_name_lower"
    if [ -d "$THEME_WALLPAPER_DIR" ]; then
        wallpaper=$(find "$THEME_WALLPAPER_DIR" -type f | shuf -n 1)
        if [ -n "$wallpaper" ]; then
            swww img "$wallpaper" --transition-type wipe --transition-angle 30 --transition-step 90
        fi
    fi
    
    echo "$theme_name_capitalized" > "$STATE_FILE"
    notify-send "ğŸ¨ Pyre: Ğ¢ĞµĞ¼Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ°" "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ° Ğ¿Ğ°Ğ»Ğ¸Ñ‚Ñ€Ğ°: $theme_name_capitalized" -i "preferences-desktop-theme"
}

# Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ ÑĞ¼ĞµĞ½Ñ‹ Ğ¾Ğ±Ğ¾ĞµĞ²
set_random_wallpaper() {
    if [ ! -d "$WALLPAPER_DIR" ] || [ -z "$(ls -A "$WALLPAPER_DIR")" ]; then
        notify-send "Pyre Error" "ĞŸĞ°Ğ¿ĞºĞ° Ñ Ğ¾Ğ±Ğ¾ÑĞ¼Ğ¸ Ğ¿ÑƒÑÑ‚Ğ°" -i "dialog-error"; return
    fi
    local wallpaper=$(find "$WALLPAPER_DIR" -type f | shuf -n 1)
    swww img "$wallpaper" --transition-type wipe --transition-angle 30 --transition-step 90
    
    # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ°Ğ»Ğ¸Ñ‚Ñ€Ñƒ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ wal
    wal -i "$wallpaper" -q -n -s
    
    # ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ğ½Ğ¸ Ğ¿Ğ¾Ğ´Ñ…Ğ²Ğ°Ñ‚Ğ¸Ğ»Ğ¸ ĞĞĞ’Ğ«Ğ• Ñ†Ğ²ĞµÑ‚Ğ° Ğ¸Ğ· ĞºÑÑˆĞ° wal
    hyprctl reload
    pkill -SIGUSR2 waybar
    pkill dunst && dunst &
    kitty @ set-colors --all --configured "$WAL_CACHE_DIR/colors-kitty.conf"
    
    echo "random" > "$STATE_FILE"
    notify-send "ï€¾ Pyre: ĞĞ±Ğ¾Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ñ‹" "ĞŸĞ°Ğ»Ğ¸Ñ‚Ñ€Ğ° ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ¸Ğ·:\n$(basename "$wallpaper")" -i "preferences-desktop-wallpaper"
}

# --- Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ ĞĞ‘Ğ ĞĞ‘ĞĞ¢Ğ§Ğ˜Ğš ---
case "$1" in
theme)
    theme_options="ï†… Latte\nï†† Mocha\nï¬ Frappe\nï‹œ Macchiato"
    chosen_theme=$(printf "%b" "$theme_options" | wofi --dmenu --prompt "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚ĞµĞ¼Ñƒ:" --width 300 --height 170)
    
    if [ -n "$chosen_theme" ]; then
        theme_name_only=$(echo "$chosen_theme" | sed -e 's/ï†… //' -e 's/ï†† //' -e 's/ï¬ //' -e 's/ï‹œ //')
        theme_to_apply=$(echo "$theme_name_only" | tr '[:upper:]' '[:lower:]')
        apply_theme "$theme_to_apply"
    fi
    ;;
wallpaper)
    set_random_wallpaper
    ;;
layout)
    launch_hollywood_layout
    ;;
files)
    launch_file_layout
    ;;
power)
    $SCRIPTS_DIR/powermenu.sh
    ;;
screenshot)
    $SCRIPTS_DIR/screenshot.sh
    ;;
clipboard)
    $SCRIPTS_DIR/clipboard_history.sh
    ;;
lock)
    $SCRIPTS_DIR/lockscreen.sh
    ;;
    *)
        # --- Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ® (ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ) ---
        
        options="ï‡¼ Theme\nï€¾ Wallpaper\nï„› Layout\nï¼ Filest\nï€‘ Power\nï€° Screenshot\nï‡š Clipboard\nï€£ Lock"
        choice=$(printf "%b" "$options" | wofi --dmenu --prompt "Pyre Mission Control:" --width 300 --height 330)

        case "$choice" in
            "ï‡¼ Theme")
                $0 theme
                ;;
            "ï€¾ Wallpaper")
                $0 wallpaper
                ;;
            "ï„› Layout")
                $0 layout
                ;;
            "ï¼ Files")
                $0 files
                ;;
            "ï€‘ Power")
                $0 power
                ;;
            "ï€° Screenshot")
                $0 screenshot
                ;;
            "ï‡š Clipboard")
                $0 clipboard
                ;;
            "ï€£ Lock")
                $0 lock
                ;;
        esac
        ;;
esac
