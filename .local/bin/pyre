#!/bin/bash

# =================================================================
#         PYRE ENGINE (v1.0 - "–•–∞–º–µ–ª–µ–æ–Ω" - –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è)
# =================================================================
# –î–∏—Ä–∏–∂–µ—Ä —Ç–µ–º –¥–ª—è "–ü—Ä–æ–µ–∫—Ç–∞ –§–µ–Ω–∏–∫—Å".

# --- 1. –ü–£–¢–ò –ö –•–†–ê–ù–ò–õ–ò–©–£ –¢–ï–ú (–í–ê–®–ê –°–¢–†–£–ö–¢–£–†–ê) ---
ENGINE_THEMES_DIR="$HOME/.config/hypr/engine/themes"
HYPR_THEMES="$ENGINE_THEMES_DIR/hypr"
WAYBAR_THEMES="$ENGINE_THEMES_DIR/waybar"
KITTY_THEMES="$ENGINE_THEMES_DIR/kitty"
DUNST_THEMES="$ENGINE_THEMES_DIR/dunst"

# --- 2. –ü–£–¢–ò –ö –†–ê–ë–û–ß–ò–ú –ö–û–ù–§–ò–ì–ê–ú (–¶–ï–õ–ò) ---
HYPR_COLORS_CONF="$HOME/.config/hypr/colors.conf"
WAYBAR_COLORS_CSS="$HOME/.config/waybar/colors.css"
WOFI_COLORS_CSS="$HOME/.config/wofi/colors.css"
KITTY_THEME_CONF="$HOME/.config/kitty/theme.conf"
DUNST_RC_FILE="$HOME/.config/dunst/dunstrc"

# --- 3. –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –°–ú–ï–ù–´ –¢–ï–ú–´ ---
switch_theme() {
    # –ü–æ–ª—É—á–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Wofi
    local selected_theme_capitalized
    selected_theme_capitalized=$(printf "Mocha\nMacchiato\nFrappe\nLatte" | wofi --dmenu --prompt="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É:")

    # –í—ã—Ö–æ–¥–∏–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª Esc
    if [ -z "$selected_theme_capitalized" ]; then
        notify-send "Pyre" "–°–º–µ–Ω–∞ —Ç–µ–º—ã –æ—Ç–º–µ–Ω–µ–Ω–∞." -i "dialog-cancel"
        return
    fi

    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–º—è –≤ –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä –¥–ª—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ (Mocha -> mocha)
    local theme_name
    theme_name=$(echo "$selected_theme_capitalized" | tr '[:upper:]' '[:lower:]')

    # --- –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –®–ê–ë–õ–û–ù–û–í ---
    cp "$HYPR_THEMES/$theme_name.conf" "$HYPR_COLORS_CONF"
    cp "$WAYBAR_THEMES/$theme_name.css" "$WAYBAR_COLORS_CSS"
    cp "$WAYBAR_THEMES/$theme_name.css" "$WOFI_COLORS_CSS"
    cp "$KITTY_THEMES/$theme_name.conf" "$KITTY_THEME_CONF"
    cp "$DUNST_THEMES/$theme_name.dunstrc" "$DUNST_RC_FILE"

    # --- –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê –°–ï–†–í–ò–°–û–í ---
    hyprctl reload
    killall waybar && waybar &
    killall dunst && dunst &
    sleep 0.5 # –ü–∞—É–∑–∞ –¥–ª—è Dunst

    # –§–∏–Ω–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    notify-send "üé® Pyre: –¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞" "–ê–∫—Ç–∏–≤–Ω–∞ –ø–∞–ª–∏—Ç—Ä–∞: $selected_theme_capitalized" -i "dialog-information"
}

# --- 4. –ì–õ–ê–í–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–û–ú–ê–ù–î ---
case "$1" in
    theme)
        switch_theme
        ;;
    wallpaper)
        notify-send "Pyre" "–ú–æ–¥—É–ª—å 'wallpaper' –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω." -i "dialog-information"
        ;;
    layout)
        notify-send "Pyre" "–ú–æ–¥—É–ª—å 'layout' –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω." -i "dialog-information"
        ;;
    *)
        main_command=$(printf "theme\nwallpaper\nlayout" | wofi --dmenu --prompt="–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥—É–ª—å Pyre:")
        if [ -n "$main_command" ]; then
            $0 "$main_command"
        fi
        ;;
esac
